/etc/systemd/system/mailer-celery-worker.service

[Unit]
Description=Mailer Celery Worker
After=network.target redis.service
StartLimitIntervalSec=300
StartLimitBurst=5

[Service]
Type=simple
User=ubuntu
Group=www-data
WorkingDirectory=/home/ubuntu/mailer_back
EnvironmentFile=/etc/systemd/system/mailer.env
ExecStart=/home/ubuntu/mailer_back/venv_for_django/bin/celery -A config.celery:app worker -l info --queues=default --concurrency=1 --pool=solo --prefetch-multiplier=1 --max-tasks-per-child=10 --hostname=worker1@%h
Restart=on-failure
RestartSec=20
TimeoutStopSec=60
KillMode=mixed

[Install]
WantedBy=multi-user.target

/etc/systemd/system/mailer-classify.service
[Unit]
Description=Run classify_unprocessed_metadata task on demand
After=network.target redis.service

[Service]
Type=oneshot
User=ubuntu
WorkingDirectory=/home/ubuntu/mailer_back
EnvironmentFile=/etc/systemd/system/mailer.env
ExecStart=/home/ubuntu/mailer_back/venv_for_django/bin/celery -A config.celery:app call email_metadata.tasks.classify_unprocessed_metadata --kwargs '{"batch_size": 10, "sleep": 2.0}'



/etc/systemd/system/mailer-classify.timer

[Unit]
Description=Run classify_unprocessed_metadata every 1 minute

[Timer]
OnBootSec=30
OnUnitActiveSec=60

[Install]
WantedBy=timers.target